config.yoast_seo.enabled = 1
config.noPageTitle = 2
[page|tx_yoastseo_dont_use = 1]
    config.noPageTitle = 0
[global]
plugin.tx_yoastseo {
    settings {
        og.image.width = 640c
        og.image.height = 480c
        twitter.image.width = 640c
        twitter.image.height = 480c

        titleFieldName = {$plugin.tx_yoastseo.titleField}
        descriptionFieldName = {$plugin.tx_yoastseo.descriptionField}
        canonicalTagFieldName = {$plugin.tx_yoastseo.canonicalTagField}
        titlePrepend = {$plugin.tx_yoastseo.titlePrepend}
        titleAppend = {$plugin.tx_yoastseo.titleAppend}
    }
    view {
        file = EXT:yoast_seo/Resources/Private/Templates/Meta.html
        partialRootPaths.0 = EXT:yoast_seo/Resources/Private/Partials/
        dataProcessing {
            10 = TYPO3\CMS\Frontend\DataProcessing\FilesProcessor
            10 {
                references.fieldName = tx_yoastseo_facebook_image
                as = openGraphImages
            }
            20 < .10
            20 {
                references.fieldName = tx_yoastseo_twitter_image
                as = twitterCardsImages
            }
        }
        variables {
            currentURL =< lib.yoastSEO.currentURL
            pageTitleComplete =< lib.yoastSEO.pageTitleComplete
            pageTitle =< lib.yoastSEO.pageTitle
            description =< lib.yoastSEO.description
            ogTitle =< lib.yoastSEO.og.title
            ogType =< lib.yoastSEO.og.type
            ogDescription =< lib.yoastSEO.og.description
            twitterCard =< lib.yoastSEO.twitter.card
            twitterTitle =< lib.yoastSEO.twitter.title
            twitterDescription =< lib.yoastSEO.twitter.description
        }
        settings {
            og.image.count = 2
        }
    }
}

lib.yoastSEO {
    currentURL = TEXT
    currentURL {
        stdWrap.typolink {
            parameter = #
            returnLast = url
            forceAbsoluteUrl = 1
            addQueryString = 1
            addQueryString.exclude = type
            useCacheHash = 1
        }

        htmlSpecialChars = 1
    }

    pageTitle = TEXT
    pageTitle.field = {$plugin.tx_yoastseo.titleField} // title

    pageTitleComplete = COA
    pageTitleComplete {
        10 = TEXT
        10.value = {$plugin.tx_yoastseo.titlePrepend}
        10.stdWrap.noTrimWrap = || |

        20 =< lib.yoastSEO.pageTitle

        30 = TEXT
        30.value = {$plugin.tx_yoastseo.titleAppend}
        30.stdWrap.noTrimWrap = | ||

        stdWrap.trim = 1
    }

    pageTitlePrepend = COA
    pageTitlePrepend {
        10 = TEXT
        10 {
            value = {$plugin.tx_yoastseo.titlePrepend}
            stdWrap.noTrimWrap = || |
        }
    }

    pageTitleAppend = COA
    pageTitleAppend {
        10 = TEXT
        10 {
            value = {$plugin.tx_yoastseo.titleAppend}
            stdWrap.noTrimWrap = | ||
        }
    }

    description = TEXT
    description {
        field = {$plugin.tx_yoastseo.descriptionField}
    }

    locale = TEXT
    locale {
        data = TSFE:config|config|locale_all
        htmlSpecialChars = 1
    }

    slug < .currentURL
    slug {
        stdWrap.typolink {
            parameter = #
            returnLast = url
            forceAbsoluteUrl = 0
            useCacheHash = 1
            addQueryString = 1
            addQueryString.exclude = type
        }

        htmlSpecialChars = 1
    }

    pathOverride = TEXT
    pathOverride {
        field = tx_realurl_pathsegment
    }

    og {
        type = TEXT
        type.value =
        title =< lib.yoastSEO.pageTitle
        description =< lib.yoastSEO.description
    }

    twitter {
        card = TEXT
        card.value = summary
        title =< lib.yoastSEO.pageTitle
        description =< lib.yoastSEO.description
    }
}

module.tx_yoastseo {
    settings {
        allowedDoktypes {
            page = 1
            backend_user_section = 6
        }

        og < plugin.tx_yoastseo.settings.og
        twitter < plugin.tx_yoastseo.settings.twitter

        titleFieldName = {$plugin.tx_yoastseo.titleField}
        descriptionFieldName = {$plugin.tx_yoastseo.descriptionField}
        canonicalTagFieldName = {$plugin.tx_yoastseo.canonicalTagField}
    }
}

yoast_seo_preview = PAGE
yoast_seo_preview {
    typeNum = {$config.yoast_seo.fe_preview_type}
    config {
        disableAllHeaderCode = 1
        absRefPrefix = /

        no_cache = 1

        additionalHeaders {
            10 {
                header = Content-type: text/xml; charset=UTF-8
            }

            20 {
                header = Access-Control-Allow-Origin: *
            }
        }
    }

    wrap = <?xml version="1.0" encoding="UTF-8"?><preview>|</preview>

    20 = COA
    20 {
        10 =< lib.yoastSEO.currentURL
        10.wrap = <url>|</url>

        20 =< lib.yoastSEO.pageTitleComplete
        20 {
            stdWrap.wrap = <title><![CDATA[|]]></title>
        }

        30 =< lib.yoastSEO.pageTitle
        30 {
            stdWrap.wrap = <pageTitle><![CDATA[|]]></pageTitle>
        }

        31 =< lib.yoastSEO.pageTitlePrepend
        31 {
            stdWrap.wrap = <pageTitlePrepend><![CDATA[|]]></pageTitlePrepend>
        }

        32 =< lib.yoastSEO.pageTitleAppend
        32 {
            stdWrap.wrap = <pageTitleAppend><![CDATA[|]]></pageTitleAppend>
        }

        40 =< lib.yoastSEO.description
        40.wrap = <description><![CDATA[|]]></description>

        50 =< lib.yoastSEO.locale
        50.wrap = <locale>|</locale>

        60 =< lib.yoastSEO.slug
        60.wrap = <slug>|</slug>

        70 =< lib.yoastSEO.pathOverride
        70.wrap = <pathOverride>|</pathOverride>

        wrap = <meta>|</meta>
    }

    30 = CONTENT
    30 {
        table = tt_content

        select {
            where = colPos >= 0
            orderBy = sorting
        }
        renderObj =< tt_content
        renderObj.stdWrap {
            wrap = <element><![CDATA[|]]></element>
            replacement {
                10.search.char = 10
                10.replace =

                # remove CDATA Objects inside the element, see Issue #85
                20.search = <![CDATA[
                20.replace =
                30.search = ]]>
                30.replace =
            }
            required = 1
        }

        wrap = <content>|</content>
    }
}

<INCLUDE_TYPOSCRIPT: source="DIR:EXT:yoast_seo/Configuration/TypoScript/Setup/Plugins">